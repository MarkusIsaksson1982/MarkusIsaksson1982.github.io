<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Memory Mirror</title>
<style>
  body { margin:0; background:#000; height:100vh; display:flex; justify-content:center; align-items:center; }
  canvas { border:4px solid #222; }
  #info { position:absolute; top:10px; left:10px; color:#444; font-family:monospace; font-size:12px; }
</style>
</head>
<body>
<video id="v" autoplay playsinline></video>
<canvas id="c" width="800" height="600"></canvas>
<div id="info">Stare into the mirror... it remembers. The longer you look, the more it distorts.</div>

<script>
const video = document.getElementById('v');
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let history = [];
let gazeTime = 0;

navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => { video.srcObject = stream; })
  .catch(err => console.error("Webcam access denied", err));

function distortImage() {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // Save frame to history every 2 seconds
  if (gazeTime % 2 === 0 && gazeTime > 0) {
    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    history.push(imgData);
    if (history.length > 10) history.shift();
  }

  // Blend old frames with distortion
  history.forEach((frame, i) => {
    const alpha = (i + 1) / (history.length + 1) * 0.4;
    const offset = i * 2 + Math.sin(gazeTime * 0.05) * 5;
    ctx.globalAlpha = alpha;
    ctx.drawImage(frame, offset, offset, canvas.width, canvas.height);
    // Add chromatic aberration
    ctx.globalCompositeOperation = 'screen';
    ctx.drawImage(frame, offset + 4, offset, canvas.width, canvas.height);
  });
  ctx.globalAlpha = 1;
  ctx.globalCompositeOperation = 'source-over';

  // Ripple distortion based on gaze time
  if (gazeTime > 5) {
    ctx.globalAlpha = 0.1;
    ctx.fillStyle = 'rgba(255,0,0,0.2)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  gazeTime++;
  requestAnimationFrame(distortImage);
}

video.onloadedmetadata = () => {
  video.play();
  distortImage();
};
</script>
</body>
</html>
