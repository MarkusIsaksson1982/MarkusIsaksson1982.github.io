<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fractal Heartbeat</title>
<style>
  body { margin:0; background:#000; overflow:hidden; height:100vh; display:flex; justify-content:center; align-items:center; }
  canvas { image-rendering: pixelated; }
  #info { position:absolute; top:10px; left:10px; color:#444; font-family:monospace; font-size:12px; }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="info">Type anythingâ€¦ watch the heart beat to your rhythm</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 600;

let time = 0;
let bpm = 60;           // initial beats per minute
let lastBeat = 0;
let pulse = 1;
let branches = [];      // fractal branches

class Branch {
  constructor(x, y, angle, length, depth) {
    this.x = x;
    this.y = y;
    this.angle = angle;
    this.length = length;
    this.depth = depth;
    this.color = `hsl(${time % 360 + depth*30}, 80%, 60%)`;
  }
  grow() {
    if (this.depth > 12) return;
    const endX = this.x + Math.cos(this.angle) * this.length;
    const endY = this.y + Math.sin(this.angle) * this.length;
    branches.push(new Branch(endX, endY, this.angle - 0.4, this.length*0.7, this.depth+1));
    branches.push(new Branch(endX, endY, this.angle + 0.4, this.length*0.7, this.depth+1));
  }
  draw() {
    const endX = this.x + Math.cos(this.angle) * this.length * pulse;
    const endY = this.y + Math.sin(this.angle) * this.length * pulse;
    ctx.strokeStyle = this.color;
    ctx.lineWidth = 3 - this.depth*0.2;
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    ctx.lineTo(endX, endY);
    ctx.stroke();
  }
}

function drawHeart() {
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const size = 120 * pulse;
  
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw pulsing heart shape
  ctx.beginPath();
  ctx.moveTo(cx, cy - size/2);
  ctx.bezierCurveTo(cx - size, cy - size, cx - size*1.5, cy, cx, cy + size);
  ctx.bezierCurveTo(cx + size*1.5, cy, cx + size, cy - size, cx, cy - size/2);
  ctx.closePath();
  ctx.fillStyle = `hsl(${time % 360}, 90%, 60%)`;
  ctx.shadowBlur = 20;
  ctx.shadowColor = `hsl(${time % 360}, 90%, 70%)`;
  ctx.fill();

  // Draw fractal branches growing from heart
  branches.forEach(b => {
    b.grow();
    b.draw();
  });

  // Clean up old branches
  if (branches.length > 500) branches.shift();
}

function animate() {
  time += 1;
  const now = performance.now();
  if (now - lastBeat > 60000 / bpm) {
    pulse = 1.3;
    lastBeat = now;
    // Add new branch every beat
    branches.push(new Branch(canvas.width/2, canvas.height/2, Math.random()*Math.PI*2, 80, 0));
  }
  pulse = Math.max(1, pulse - 0.02);
  drawHeart();
  requestAnimationFrame(animate);
}

// Listen to every keypress to update BPM
document.addEventListener('keydown', () => {
  const now = performance.now();
  if (lastBeat > 0) {
    const interval = now - lastBeat;
    bpm = Math.max(40, Math.min(200, 60000 / interval));
  }
  lastBeat = now;
});

// Start
animate();
</script>
</body>
</html>
