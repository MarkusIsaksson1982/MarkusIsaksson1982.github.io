<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<pre style="white-space: pre-wrap; font-family: sans-serif;">
---
Type: Code artifact generated by ChatGPT-5 
Author: ChatGPT-5
File name(s): (snippets)
Keywords: [not added yet]
---

<!-- Lägg till i <head> -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js"></script>

// === Firebase setup ===
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "your-project.firebaseapp.com",
  databaseURL: "https://your-project-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "your-project",
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database(app);

// Hjälpfunktion: reference för aktuell vecka
function getHighscoresRef(week) {
  return db.ref(`highscores/week_${week || 'general'}`);
}

// === Leaderboard state ===
let currentWeek = quiz.week || 'general';

// Push resultat till molnet
function pushResult(name, score) {
  getHighscoresRef(currentWeek).push({
    name,
    score,
    date: new Date().toISOString()
  });
}

// Lyssna på uppdateringar i realtid för aktuell vecka
function listenToLeaderboard(week) {
  getHighscoresRef(week).on('value', (snapshot) => {
    const scores = [];
    snapshot.forEach((child) => scores.push(child.val()));
    scores.sort((a, b) => b.score - a.score);
    renderLeaderboard(scores, week);
  });
}

// Rendera leaderboard till DOM
function renderLeaderboard(scores, week) {
  const div = document.getElementById('leaderboard');
  div.innerHTML = `<h3>Leaderboard – Vecka ${week}</h3><ul>` +
    scores.slice(0, 5).map(s =>
      `<li>${s.name}: ${s.score} poäng (${s.date.split('T')[0]})</li>`
    ).join('') +
    '</ul>';
}

// Efter submit i quiz
function submitQuiz() {
  // ... befintlig poängräkning
  const score = calculateScore(); // <-- din egen funktion
  pushResult(currentProfile, score);
  // Resten av submit hantering
}

// Rensa leaderboard för aktuell vecka (lärarknapp)
function clearLeaderboard() {
  if (confirm(`Rensa leaderboard för vecka ${currentWeek}?`)) {
    getHighscoresRef(currentWeek).remove();
  }
}

// === Visa alla veckor-vy ===
function populateWeeksDropdown() {
  db.ref('highscores').once('value').then(snapshot => {
    const weeks = Object.keys(snapshot.val() || {});
    const select = document.getElementById('week-select');
    select.innerHTML = weeks.map(w =>
      `<option value="${w.replace('week_', '')}">${w.replace('week_', '')}</option>`
    ).join('');
    if (weeks.length) {
      currentWeek = weeks[0].replace('week_', '');
      listenToLeaderboard(currentWeek);
    }
  });
}

// Byt vecka via dropdown
function switchWeek() {
  const select = document.getElementById('week-select');
  currentWeek = select.value;
  listenToLeaderboard(currentWeek);
}

// === Kör vid sidladdning ===
document.addEventListener('DOMContentLoaded', () => {
  populateWeeksDropdown();
});

<!-- I <body> -->
<label for="week-select">Visa leaderboard för vecka:</label>
<select id="week-select" onchange="switchWeek()"></select>
<div id="leaderboard" style="margin-top:20px;"></div>
<button onclick="clearLeaderboard()">Rensa aktuell leaderboard</button>

</pre>

</body>
</html>
